{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Dashboard</h2>
  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('web.visitor_new') }}">New Visitor</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('web.visit_record') }}">Record Visit</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('web.ticket_record') }}">Record Ticket</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('web.feedback_record') }}">Record Feedback</a>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('web.conservation_new') }}">Add Conservation</a>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Visits by Exhibit</h5>
        <table class="table table-sm">
          <thead><tr><th>Exhibit</th><th class="text-end">Visits</th></tr></thead>
          <tbody>
            {% for row in visits_by_exhibit %}
              <tr><td>{{ row.title }}</td><td class="text-end">{{ row.visits }}</td></tr>
            {% else %}
              <tr><td colspan="2" class="text-muted">No visit data yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Average Ratings by Exhibit</h5>
        <table class="table table-sm">
          <thead><tr><th>Exhibit</th><th class="text-end">Avg</th><th class="text-end">Count</th></tr></thead>
          <tbody>
            {% for row in avg_ratings %}
              <tr><td>{{ row.title }}</td><td class="text-end">{{ "%.2f"|format(row.avg_rating) }}</td><td class="text-end">{{ row.num_feedback }}</td></tr>
            {% else %}
              <tr><td colspan="3" class="text-muted">No feedback yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Conservation Due (Next 30 days)</h5>
        <table class="table table-sm">
          <thead><tr><th>Artefact</th><th>Due</th><th>Condition</th></tr></thead>
          <tbody>
            {% for row in due_soon %}
              <tr><td>{{ row.name }}</td><td>{{ row.due_date }}</td><td>{{ row.condition }}</td></tr>
            {% else %}
              <tr><td colspan="3" class="text-muted">No upcoming conservation.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Visit Trend & Forecast</h5>
        <table class="table table-sm">
          <thead><tr><th>Month</th><th class="text-end">Visits</th></tr></thead>
          <tbody>
            {% for ym, c in monthly %}
              <tr><td>{{ ym }}</td><td class="text-end">{{ c }}</td></tr>
            {% else %}
              <tr><td colspan="2" class="text-muted">No monthly data.</td></tr>
            {% endfor %}
          </tbody>
        </table>
        {% if forecast %}
          <h6 class="mt-3">Forecast (next 3 months)</h6>
          <table class="table table-sm">
            <thead><tr><th>Month</th><th class="text-end">Predicted</th><th>Method</th></tr></thead>
            <tbody>
              {% for f in forecast %}
                <tr><td>{{ f.year_month }}</td><td class="text-end">{{ f.predicted_visits }}</td><td class="text-muted">{{ f.method }}</td></tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
